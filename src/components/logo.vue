<template>
  <div class="n flex h-[50px] items-center overflow-hidden px-2.5">
    <a
      href="https://github.com/gp0119/Taby"
      target="_blank"
      class="flex items-center justify-center text-primary"
    >
      <svg
        class="h-10"
        viewBox="0 0 48 48"
        fill="currentColor"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M0 12C0 5.37258 5.37258 0 12 0H36C42.6274 0 48 5.37258 48 12V36C48 42.6274 42.6274 48 36 48H12C5.37258 48 0 42.6274 0 36V12Z"
        />
        <path
          d="M33.4831 15.0101C33.4831 15.0101 35.9032 21.8385 34.9526 26.8472C33.6703 33.6049 27.6129 36.2488 26.5608 36.4798C19.8219 37.9588 13.8125 34.8217 13.5215 37.3524C12.9313 42.4858 26.7536 36.9765 26.7536 36.9765C26.7536 36.9765 41.9713 31.3061 38.2848 35.2974C34.1581 39.7652 19.3736 41.4332 16.5245 41.2537C8.10648 40.7231 11.1446 35.7015 13.7323 34.4985C13.7323 34.4985 11.8689 29.0449 16.4808 26.5189C21.0922 23.9925 31.1975 24.8745 33.4831 15.0101Z"
          fill="white"
        />
        <path
          d="M23.1883 13.3191C22.9427 13.7443 22.515 13.9569 22.2326 13.794C21.9506 13.6311 21.9206 13.1541 22.1661 12.729C22.4117 12.3039 22.8394 12.0913 23.1219 12.2541C23.4039 12.417 23.4339 12.894 23.1883 13.3191ZM30.6356 10.1983C30.6356 10.1983 31.1366 8.00229 30.7821 6.15943L28.1494 7.95257C28.1494 7.95257 28.4477 6.68143 28.4074 6L25.7031 8.15314C25.7031 8.15314 20.8239 6.33643 18.9261 11.1604C18.9261 11.1604 16.2394 11.0001 15.7183 11.8423C15.7183 11.8423 15.3836 16.791 19.6719 17.9074C23.5419 18.915 23.8183 22.9903 23.8183 22.9903C23.8183 22.9903 30.7556 21.1054 32.1994 17.0554C33.6429 13.0054 30.6356 10.1983 30.6356 10.1983Z"
          fill="white"
        />
      </svg>
    </a>
    <div
      class="flex flex-1 items-center justify-between"
      :class="[layoutStore.isLeftCollapsed ? 'animate-hide' : 'animate-show']"
    >
      <a
        href="https://github.com/gp0119/Taby"
        target="_blank"
        class="ml-3 text-primary"
      >
        <svg
          class="mt-1.5 h-6"
          viewBox="0 0 94 38"
          fill="currentColor"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M0 5.07101V0H23.892V5.07101H14.9857V29.0909H8.9062V5.07101H0ZM30.9659 29.5028C29.5738 29.5028 28.3333 29.2614 27.2443 28.7784C26.1553 28.286 25.2935 27.5615 24.659 26.6051C24.034 25.6392 23.7215 24.4365 23.7215 22.9971C23.7215 21.785 23.9441 20.767 24.3892 19.9432C24.8342 19.1193 25.4403 18.4564 26.2073 17.9545C26.9744 17.4526 27.8456 17.0739 28.821 16.8182C29.8058 16.5625 30.838 16.3826 31.9176 16.2784C33.1865 16.1458 34.2092 16.0227 34.9857 15.9091C35.7623 15.786 36.3257 15.6061 36.6761 15.3693C37.0265 15.1326 37.2017 14.7822 37.2017 14.3182V14.2329C37.2017 13.3333 36.9176 12.6373 36.3494 12.1449C35.7907 11.6525 34.9952 11.4062 33.963 11.4062C32.874 11.4062 32.0075 11.6477 31.3636 12.1307C30.7197 12.6042 30.2935 13.2007 30.0852 13.9204L24.4886 13.4659C24.7727 12.1401 25.3314 10.9943 26.1647 10.0284C26.9981 9.05301 28.0729 8.30491 29.3892 7.78411C30.7149 7.25381 32.249 6.98861 33.9914 6.98861C35.2036 6.98861 36.3636 7.13071 37.4715 7.41481C38.5885 7.69891 39.5785 8.13921 40.4405 8.73581C41.3115 9.33241 41.9985 10.0994 42.4995 11.0369C43.0015 11.965 43.2525 13.0776 43.2525 14.375V29.0909H37.5142V26.0653H37.3437C36.9933 26.7471 36.5246 27.3485 35.9375 27.8693C35.3503 28.3807 34.6448 28.7831 33.821 29.0767C32.9971 29.3608 32.0454 29.5028 30.9659 29.5028ZM32.6988 25.3267C33.589 25.3267 34.375 25.1515 35.0568 24.8011C35.7386 24.4413 36.2736 23.9583 36.6619 23.3523C37.0501 22.7462 37.2443 22.0596 37.2443 21.2926V18.9773C37.0549 19.1004 36.7945 19.214 36.463 19.3182C36.1411 19.4129 35.7765 19.5028 35.3693 19.5881C34.9621 19.6638 34.5549 19.7348 34.1477 19.8011C33.7405 19.8579 33.3712 19.91 33.0397 19.9574C32.3295 20.0615 31.7092 20.2273 31.1789 20.4545C30.6486 20.6818 30.2367 20.9896 29.9431 21.3778C29.6496 21.7566 29.5028 22.2301 29.5028 22.7983C29.5028 23.6221 29.8011 24.2519 30.3977 24.6875C31.0037 25.1136 31.7708 25.3267 32.6988 25.3267ZM48.0615 29.0909V0H54.1125V10.9375H54.2965C54.5615 10.3504 54.9455 9.75381 55.4475 9.14771C55.9585 8.53221 56.6215 8.02081 57.4365 7.61361C58.2595 7.19701 59.2825 6.98861 60.5045 6.98861C62.0955 6.98861 63.5625 7.40531 64.9075 8.23861C66.2525 9.06251 67.3275 10.3078 68.1325 11.9744C68.9365 13.6316 69.3395 15.7102 69.3395 18.2102C69.3395 20.6439 68.9465 22.6989 68.1605 24.375C67.3835 26.0417 66.3235 27.3059 64.9785 28.1676C63.6435 29.0199 62.1475 29.446 60.4905 29.446C59.3155 29.446 58.3165 29.2519 57.4925 28.8636C56.6785 28.4754 56.0105 27.9877 55.4905 27.4006C54.9695 26.804 54.5715 26.2026 54.2965 25.5966H54.0265V29.0909H48.0615ZM53.9845 18.1818C53.9845 19.4792 54.1645 20.6108 54.5245 21.5767C54.8835 22.5426 55.4045 23.2954 56.0865 23.8352C56.7685 24.3655 57.5975 24.6307 58.5725 24.6307C59.5575 24.6307 60.3905 24.3608 61.0725 23.821C61.7545 23.2718 62.2705 22.5142 62.6205 21.5483C62.9805 20.5729 63.1605 19.4507 63.1605 18.1818C63.1605 16.9223 62.9855 15.8144 62.6345 14.8579C62.2845 13.9015 61.7685 13.1534 61.0865 12.6136C60.4045 12.0739 59.5665 11.804 58.5725 11.804C57.5875 11.804 56.7545 12.0644 56.0725 12.5852C55.4005 13.1061 54.8835 13.8447 54.5245 14.8011C54.1645 15.7576 53.9845 16.8845 53.9845 18.1818ZM76.4095 37.2727C75.6425 37.2727 74.9235 37.2112 74.2505 37.0881C73.5875 36.9744 73.0385 36.8276 72.6025 36.6477L73.9665 32.1307C74.6765 32.3485 75.3165 32.4668 75.8845 32.4858C76.4615 32.5047 76.9585 32.3722 77.3755 32.0881C77.8015 31.804 78.1475 31.321 78.4125 30.6392L78.7675 29.7159L70.9415 7.27271H77.3045L81.8215 23.2954H82.0485L86.6085 7.27271H93.0145L84.5345 31.4489C84.1275 32.6231 83.5735 33.6458 82.8725 34.517C82.1815 35.3977 81.3055 36.0748 80.2445 36.5483C79.1845 37.0312 77.9055 37.2727 76.4095 37.2727Z"
          />
        </svg>
      </a>
      <div class="flex flex-nowrap items-center gap-x-2">
        <PopoverWrapper :message="ft('add', 'space')" @click="onAddSpace">
          <n-icon
            :component="Add"
            size="24"
            class="cursor-pointer [&_svg]:stroke-current [&_svg]:stroke-[0.5px]"
          />
        </PopoverWrapper>
      </div>
    </div>
  </div>
</template>

<script setup lang="tsx">
import { useLayoutStore } from "@/store/layout"
import { Add } from "@vicons/carbon"
import { useHelpi18n } from "@/hooks/useHelpi18n"
import { useEditDialog } from "@/hooks/useEditDialog.tsx"
import IconSelect from "@components/icon-select.vue"
import dataManager from "@/db"
import { useRefresh } from "@/hooks/useRresh.ts"
import PopoverWrapper from "./popover-wrapper.vue"

const layoutStore = useLayoutStore()
const { ft } = useHelpi18n()
const { open } = useEditDialog()
const { refreshSpaces } = useRefresh()

function onAddSpace() {
  const formModel = ref({ title: "", icon: "StorefrontOutline" })
  open({
    title: ft("add", "space"),
    renderContent: () => (
      <n-form model={formModel.value}>
        <n-form-item label={`${ft("title")}:`}>
          <n-input-group>
            <IconSelect v-model:value={formModel.value.icon} />
            <n-input
              v-model:value={formModel.value.title}
              placeholder={ft("placeholder", "title")}
            />
          </n-input-group>
        </n-form-item>
      </n-form>
    ),
    onPositiveClick: async () => {
      if (!formModel.value.title) return
      await dataManager.addSpace({
        title: formModel.value.title,
        icon: formModel.value.icon,
      })
      await refreshSpaces()
    },
  })
}
</script>
